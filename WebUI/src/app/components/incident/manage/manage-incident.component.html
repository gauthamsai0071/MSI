<app-header></app-header>
<div class="form-wrapper incidents">
    <msi-card>
        <msi-card-title class="msi-border-primary-10">
            <span>{{ title }} Incident</span>
        </msi-card-title>
        <msi-card-content>
            <form [formGroup]="incidentForm" (ngSubmit)="onSubmit()" *ngIf="incidentForm !== null">
                <div *ngFor="let field of customFields">
                    <div *ngIf="field.isTimestamp">
                        <div class="form-group">
                            <label class="msi-label" for="{{ field.name }}">
                                {{ field.displayName }}
                            </label>
                            <msi-date-time-picker-control formControlName="{{ field.name }}" [dropdown]="true"
                                [defaultValue]="calendarDateTimeDefaultValue" [dateFormat]='"DD/MM/YYYY"'
                                [timeFormat]="'HH:mm'" [dateTimeMask]='"00/00/0000 00:00"'
                                [disabled]="(field.fieldType === 'USER_DEFINED' && !view) ? false : true"
                                (dateChanged)="onCalendarDateChanged($event, field.id)" #customDatepicker>
                            </msi-date-time-picker-control>
                        </div>
                    </div>
                    <div *ngIf="field.isText || field.isUrl">
                        <div class="form-group">
                            <label class="msi-label" for="{{ field.name }}">
                                {{ field.displayName }}
                            </label>
                            <div *ngIf="field.numTextLines === 0 || field.numTextLines === 1">
                                <app-input-control *ngIf="field.mandatory; else textOptional" [controlName]="field.name"
                                    [formResetting]="formResetting" [LabelText]="field.displayName">
                                    <input class="msi-input" type="text" autocomplete="{{ field.name }}"
                                        formControlName="{{ field.name }}"
                                        [readonly]="(field.fieldType === 'USER_DEFINED' && !view) ? false : true"
                                        [class.error]="!formResetting && formControls[field.name].invalid">
                                </app-input-control>
                                <ng-template #textOptional>
                                    <input class="msi-input" type="text" formControlName="{{field.name}}"
                                        [readonly]="(field.fieldType === 'USER_DEFINED' && !view) ? false : true">
                                </ng-template>
                            </div>
                            <div *ngIf="field.numTextLines > 1">
                                <app-input-control *ngIf="field.mandatory; else textareaOptional"
                                    [controlName]="field.name" [formResetting]="formResetting"
                                    [LabelText]="field.displayName">
                                    <textarea class="msi-textarea" formControlName="{{field.name}}"
                                        rows="{{field.numTextLines}}"
                                        [readonly]="(field.fieldType === 'USER_DEFINED' && !view) ? false : true"
                                        [class.error]="!formResetting && formControls[field.name].invalid"></textarea>
                                </app-input-control>
                                <ng-template #textareaOptional>
                                    <textarea class="msi-textarea" formControlName="{{field.name}}"
                                        rows="{{field.numTextLines}}"
                                        [readonly]="(field.fieldType === 'USER_DEFINED' && !view) ? false : true"></textarea>
                                </ng-template>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="field.isBool">
                        <div class="form-group">
                            <label class="msi-label" for="{{ field.name }}">
                                {{ field.displayName }}
                            </label>
                            <app-input-control *ngIf="field.mandatory; else checkboxOptional" [controlName]="field.name"
                                [formResetting]="formResetting" [LabelText]="field.displayName">
                                <msi-checkbox formControlName="{{ field.name }}"
                                    [disabled]="(field.fieldType === 'USER_DEFINED' && !view) ? false : true"
                                    [class.error]="!formResetting && formControls[field.name].invalid"></msi-checkbox>
                            </app-input-control>
                            <ng-template #checkboxOptional>
                                <msi-checkbox formControlName="{{ field.name }}"
                                    [disabled]="(field.fieldType === 'USER_DEFINED' && !view) ? false : true">
                                </msi-checkbox>
                            </ng-template>
                        </div>
                    </div>
                    <div *ngIf="field.isEnumeration">
                        <div *ngIf="field.displayName.includes(',radio,')" class="form-group">
                            <label class="msi-label" for="{{ field.name }}">
                                {{field.displayName.split(',radio,').slice(0, -1)}}
                            </label>
                            <app-input-control *ngIf="field.mandatory; else radioGroupOptional"
                                [controlName]="field.name" [formResetting]="formResetting"
                                [LabelText]="field.displayName">
                                <msi-radio-group class="radio-group" [inline]="true" formControlName="{{field.name}}"
                                    [class.error]="!formResetting && formControls[field.name].invalid">
                                    <msi-radio-button class="msi-radio-button" ngDefaultControl
                                        [disabled]="(field.fieldType === 'USER_DEFINED' && !view) ? false : true"
                                        *ngFor="let option of field.validValues; let i = index" [value]="option">
                                        {{field.validValueLabels[i]}}</msi-radio-button>
                                </msi-radio-group>
                            </app-input-control>
                            <ng-template #radioGroupOptional>
                                <msi-radio-group class="radio-group" [inline]="true" formControlName="{{field.name}}">
                                    <msi-radio-button class="msi-radio-button" ngDefaultControl
                                        [disabled]="(field.fieldType === 'USER_DEFINED' && !view) ? false : true"
                                        *ngFor="let option of field.validValues; let i = index" [value]="option">
                                        {{field.validValueLabels[i]}}</msi-radio-button>
                                </msi-radio-group>
                            </ng-template>
                        </div>
                        <div *ngIf="field.displayName.includes(',checkbox,')" class="form-group">
                            <label class="msi-label" for="{{ field.name }}">
                                {{field.displayName.split(',checkbox,').slice(0, -1)}}
                            </label>
                            <app-input-control *ngIf="field.mandatory; else checkboxGroupOptional"
                                [controlName]="field.name" [formResetting]="formResetting"
                                [LabelText]="field.displayName">
                                <msi-checkbox-group class="checkbox-group">
                                    <msi-checkbox class="{{field.name}}" formControlName="{{field.name}}"
                                        ngDefaultControl
                                        [disabled]="(field.fieldType === 'USER_DEFINED' && !view) ? false : true"
                                        (change)="onCheckboxChange( $event, option, field.id)"
                                        *ngFor="let option of field.validValues; let i = index"
                                        [value]="field.validValues[i]"
                                        >{{field.validValueLabels[i]}}</msi-checkbox>
                                </msi-checkbox-group>
                            </app-input-control>
                            <ng-template #checkboxGroupOptional>
                                <msi-checkbox-group class="checkbox-group">
                                    <msi-checkbox class="{{field.name}}" formControlName="{{field.name}}"
                                        ngDefaultControl
                                        [disabled]="(field.fieldType === 'USER_DEFINED' && !view) ? false : true"
                                        (change)="onCheckboxChange( $event, option, field.id)"
                                        *ngFor="let option of field.validValues; let i = index"
                                        [value]="field.validValues[i]"
                                        >{{field.validValueLabels[i]}}</msi-checkbox>
                                </msi-checkbox-group>
                            </ng-template>
                        </div>
                        <div *ngIf="field.displayName.includes(',multiselect,')" class="form-group ng-multiselect">
                            <label class="msi-label" for="{{ field.name }}">
                                {{field.displayName.split(',multiselect,').slice(0, -1)}}
                            </label>
                            <app-input-control *ngIf="field.mandatory; else multiSelectOptional"
                                [controlName]="field.name" [formResetting]="formResetting"
                                [LabelText]="field.displayName">
                                <ng-multiselect-dropdown [settings]="dropdownSettings" [placeholder]="'Select'"
                                    formControlName="{{field.name}}" [data]="field.validValues"
                                    (onSelect)="onMultiSelectChanged($event, field.id, 1)"
                                    (onSelectAll)="onMultiSelectChanged($event, field.id, 1)"
                                    (onDeSelect)="onMultiSelectChanged($event, field.id, 0)"
                                    (onDeSelectAll)="onMultiSelectChanged($event, field.id, 0)"
                                    [disabled]="(field.fieldType === 'USER_DEFINED' && !view) ? false : true"
                                    [class.error]="!formResetting && formControls[field.name].invalid">
                                </ng-multiselect-dropdown>
                            </app-input-control>
                            <ng-template #multiSelectOptional>
                                <ng-multiselect-dropdown [settings]="dropdownSettings" [placeholder]="'Select'"
                                    [data]="field.validValues" (onSelect)="onMultiSelectChanged($event, field.id, 1)"
                                    (onSelectAll)="onMultiSelectChanged($event, field.id, 1)"
                                    (onDeSelect)="onMultiSelectChanged($event, field.id, 0)"
                                    (onDeSelectAll)="onMultiSelectChanged($event, field.id, 0)"
                                    formControlName="{{field.name}}"
                                    [disabled]="(field.fieldType === 'USER_DEFINED' && !view) ? false : true">
                                </ng-multiselect-dropdown>
                            </ng-template>
                        </div>
                        <div *ngIf="!(field.displayName.includes(',radio,') || field.displayName.includes(',checkbox,') || field.displayName.includes(',multiselect,'))"
                            class="form-group">
                            <label class="msi-label" for="{{ field.name }}">
                                {{ field.displayName }}
                            </label>
                            <app-input-control *ngIf="field.mandatory; else selectOptional" [controlName]="field.name"
                                [formResetting]="formResetting" [LabelText]="field.displayName">
                                <msi-select formControlName="{{field.name}}" placeholder="Select Value"
                                    [disabled]="(field.fieldType === 'USER_DEFINED' && !view) ? false : true">
                                    <msi-select-option *ngFor="let option of field.validValues; let i = index"
                                        [value]="option">{{field.validValueLabels[i]}}</msi-select-option>
                                </msi-select>
                            </app-input-control>
                            <ng-template #selectOptional>
                                <msi-select formControlName="{{field.name}}" placeholder="Select Value"
                                    [disabled]="(field.fieldType === 'USER_DEFINED' && !view) ? false : true">
                                    <msi-select-option *ngFor="let option of field.validValues; let i = index"
                                        [value]="option">{{field.validValueLabels[i]}}</msi-select-option>
                                </msi-select>
                            </ng-template>
                        </div>
                    </div>
                </div>
                <div *ngIf="!view">
                    <button type="submit" class="msi-btn form-button">Submit</button>
                </div>
            </form>
        </msi-card-content>
    </msi-card>
</div>